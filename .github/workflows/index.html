<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WOW To-Do List App â€” Fixed Search</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg: linear-gradient(135deg,#4f46e5,#9333ea);
  --card: rgba(255,255,255,0.15);
  --text: #fff;
  --muted: rgba(255,255,255,0.75);
  --accent: #60a5fa;
  --ok: #22c55e;
  --danger: #ef4444;
  --shadow: rgba(0,0,0,0.25);
}
body.dark{
  --bg: linear-gradient(135deg,#0f0f0f,#1f1f1f);
  --card: rgba(255,255,255,0.08);
  --text: #e5e5e5;
  --muted: rgba(255,255,255,0.65);
  --accent: #3b82f6;
  --ok: #16a34a;
  --danger: #ef4444;
  --shadow: rgba(255,255,255,0.06);
}

*{box-sizing:border-box; margin:0; padding:0; font-family:"Poppins",sans-serif; transition:all .18s ease}

body{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--bg);
  color:var(--text);
  padding:20px;
}

.container{
  width:430px;
  background:var(--card);
  padding:22px;
  border-radius:18px;
  backdrop-filter:blur(12px) saturate(120%);
  box-shadow:0 10px 30px var(--shadow);
  position:relative;
}

/* header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.title{font-size:22px; font-weight:700; letter-spacing:0.2px}
.sub{font-size:12px; color:var(--muted)}

/* controls */
.controls-row{display:flex; gap:10px; margin-top:14px}
.input, select, .search-input{
  padding:11px 12px;
  border-radius:10px;
  border:none;
  outline:none;
  font-size:14px;
  color:var(--text);
  background:rgba(255,255,255,0.06);
}
.input{flex:1}
.select-cat{width:120px}
.add-btn{
  background:var(--ok);
  border:none;
  padding:11px 13px;
  border-radius:10px;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
.add-btn:hover{transform:translateY(-3px)}

/* filters & search */
.row{display:flex; gap:8px; margin-top:12px}
.filter-btn{
  flex:1;
  padding:8px 10px;
  background:transparent;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  color:var(--muted);
  cursor:pointer;
  font-weight:600;
}
.filter-btn.active{background:var(--accent); color:#fff; border:none}

/* list */
.list{
  margin-top:14px;
  max-height:340px;
  overflow:auto;
  padding-right:6px;
}
.list::-webkit-scrollbar{width:8px}
.list::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08); border-radius:8px}

.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background:rgba(255,255,255,0.06);
  padding:10px 12px;
  border-radius:10px;
  margin-bottom:10px;
  font-size:15px;
}
.left{display:flex; gap:10px; align-items:center}
.check{width:18px; height:18px}
.item .meta{font-size:12px; color:var(--muted); margin-left:6px}
.actions{display:flex; gap:6px; align-items:center}

/* small buttons */
.btn{
  padding:7px 9px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:600;
  font-size:13px;
}
.edit{background:rgba(59,130,246,0.95); color:#fff}
.del{background:var(--danger); color:#fff}

/* counters & footer */
.footer{display:flex; justify-content:space-between; align-items:center; margin-top:10px; color:var(--muted); font-weight:600}
.match-highlight{background:rgba(255,255,255,0.14); padding:2px 4px; border-radius:4px}

/* small responsive */
@media (max-width:480px){
  .container{width:100%}
  .select-cat{display:none}
}
</style>
</head>
<body>

<div class="container" role="application" aria-label="ToDo App">
  <div class="header">
    <div>
      <div class="title">WOW To-Do App âœ¨</div>
      <div class="sub">Powerful single-file task manager</div>
    </div>
    <div>
      <button id="themeBtn" class="btn" onclick="toggleTheme()">ðŸŒ™</button>
    </div>
  </div>

  <!-- search -->
  <div class="row" style="margin-top:12px">
    <input id="searchInput" class="search-input" placeholder="Search tasks (live)..." oninput="renderTasks()" />
    <select id="filterCategory" class="select-cat" onchange="renderTasks()">
      <option value="">All Categories</option>
      <option>Work</option>
      <option>Personal</option>
      <option>Study</option>
      <option>Shopping</option>
    </select>
  </div>

  <!-- add -->
  <div class="controls-row">
    <input id="taskInput" class="input" placeholder="Add a new task..." aria-label="Task text" />
    <select id="category" class="select-cat" aria-label="Category">
      <option>Work</option>
      <option>Personal</option>
      <option>Study</option>
      <option>Shopping</option>
    </select>
    <button class="add-btn" onclick="addTask()">Add</button>
  </div>

  <!-- quick filters -->
  <div class="row" style="margin-top:12px">
    <button class="filter-btn active" id="fAll" onclick="setFilter('all')">All</button>
    <button class="filter-btn" id="fPending" onclick="setFilter('pending')">Pending</button>
    <button class="filter-btn" id="fDone" onclick="setFilter('completed')">Completed</button>
  </div>

  <!-- tasks list -->
  <ul id="taskList" class="list" aria-live="polite"></ul>

  <div class="footer">
    <div id="counter">0 Tasks</div>
    <div id="visibleCount"></div>
  </div>
</div>

<script>
/* ===== data & load/save ===== */
let tasks = JSON.parse(localStorage.getItem("wowTasks")) || [];
let filter = "all"; // all | pending | completed

function save(){
  localStorage.setItem("wowTasks", JSON.stringify(tasks));
}

/* ===== theme toggle ===== */
function toggleTheme(){
  document.body.classList.toggle("dark");
  const btn = document.getElementById("themeBtn");
  btn.textContent = document.body.classList.contains("dark") ? "â˜€ï¸" : "ðŸŒ™";
}

/* ===== add, edit, delete, toggle ===== */
function addTask(){
  const text = document.getElementById("taskInput").value.trim();
  const cat = document.getElementById("category").value;
  if(!text) return flashInput();
  tasks.push({ text, cat, done:false, created: Date.now() });
  save(); renderTasks();
  document.getElementById("taskInput").value = "";
}

function flashInput(){
  const el = document.getElementById("taskInput");
  el.animate([{ boxShadow:'0 0 0 0 rgba(255,0,0,0)' }, { boxShadow:'0 0 8px 3px rgba(255,0,0,0.25)' }, { boxShadow:'0 0 0 0 rgba(255,0,0,0)' }], { duration:500 });
  el.focus();
}

function deleteTask(idx){
  if(!confirm("Delete this task?")) return;
  tasks.splice(idx,1);
  save(); renderTasks();
}

function editTask(idx){
  const newText = prompt("Edit task:", tasks[idx].text);
  if(newText === null) return; // cancelled
  const trimmed = newText.trim();
  if(!trimmed) return alert("Task cannot be empty.");
  tasks[idx].text = trimmed;
  save(); renderTasks();
}

function toggleDone(idx){
  tasks[idx].done = !tasks[idx].done;
  save(); renderTasks();
}

/* ===== filtering & rendering ===== */
function setFilter(f){
  filter = f;
  document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
  if(f==="all") document.getElementById("fAll").classList.add("active");
  if(f==="pending") document.getElementById("fPending").classList.add("active");
  if(f==="completed") document.getElementById("fDone").classList.add("active");
  renderTasks();
}

function renderTasks(){
  const ul = document.getElementById("taskList");
  ul.innerHTML = "";

  const searchRaw = document.getElementById("searchInput").value.toLowerCase();
  const categoryFilter = document.getElementById("filterCategory").value;

  // Map tasks to include original index so handlers act on correct task
  const mapped = tasks.map((t, idx) => ({ ...t, __idx: idx }));

  // Apply filters
  const visible = mapped.filter(t => {
    if(filter === "completed" && !t.done) return false;
    if(filter === "pending" && t.done) return false;
    if(categoryFilter && t.cat !== categoryFilter) return false;
    if(searchRaw && !t.text.toLowerCase().includes(searchRaw)) return false;
    return true;
  });

  // Build list items using original index
  visible.forEach(item => {
    const li = document.createElement("li");
    li.className = "item";

    // highlight matched substrings in text
    const highlighted = highlightText(item.text, searchRaw);

    li.innerHTML = `
      <div class="left">
        <input aria-label="Mark done" class="check" type="checkbox" ${item.done ? "checked":""} onclick="toggleDone(${item.__idx})">
        <div>
          <div style="font-weight:600; text-decoration:${item.done ? 'line-through':'none'}">${highlighted}</div>
          <div class="meta">${item.cat} â€¢ ${new Date(item.created).toLocaleString()}</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn edit" onclick="editTask(${item.__idx})">Edit</button>
        <button class="btn del" onclick="deleteTask(${item.__idx})">Delete</button>
      </div>
    `;
    ul.appendChild(li);
  });

  // counters
  document.getElementById("counter").textContent = `${tasks.length} Tasks`;
  document.getElementById("visibleCount").textContent = `${visible.length} shown`;
}

/* ===== helper: highlight search matches ===== */
function escapeHtml(s){
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function highlightText(text, q){
  if(!q) return escapeHtml(text);
  const lower = text.toLowerCase();
  let start = 0;
  let out = "";
  let idx;
  while((idx = lower.indexOf(q, start)) !== -1){
    out += escapeHtml(text.slice(start, idx));
    out += `<span class="match-highlight">${escapeHtml(text.slice(idx, idx+q.length))}</span>`;
    start = idx + q.length;
  }
  out += escapeHtml(text.slice(start));
  return out;
}

/* ===== initial render ===== */
renderTasks();

/* ===== keyboard: Enter to add ===== */
document.getElementById("taskInput").addEventListener("keydown", e => {
  if(e.key === "Enter") addTask();
});
document.getElementById("searchInput").addEventListener("keydown", e => {
  if(e.key === "Escape") { document.getElementById("searchInput").value=''; renderTasks(); }
});
</script>
</body>
</html>
